# DevWheels 功能说明文档

## 项目概述

DevWheels 是一个基于 Spring Boot 3.5.4 + Java 17 的基础轮子项目，旨在为后续项目开发提供通用的代码基础和架构模板。项目集成了常用的开发组件和最佳实践，提供了完整的企业级开发基础设施。

## 技术栈

- **框架**: Spring Boot 3.5.4
- **语言**: Java 17
- **数据层**: MyBatis-Plus 3.5.7
- **权限认证**: Sa-Token 1.44.0
- **API文档**: Knife4j 4.4.0
- **Excel处理**: EasyExcel 3.3.4
- **数据库**: MySQL
- **测试框架**: JUnit 5 + Mockito
- **构建工具**: Maven

## 核心功能模块

### 1. 通用基础架构层

#### DWEntity - 通用实体基类
- **位置**: `com.dw.common.entity.DWEntity`
- **功能**:
  - 包含 id、createTime、updateTime、isDeleted 字段
  - 支持逻辑删除
  - 自动时间填充
- **使用示例**:
```java
@Entity
public class User extends DWEntity {
    private String username;
    private String email;
    // getter/setter
}
```

#### DWMapper - 通用 Mapper 接口
- **位置**: `com.dw.common.mapper.DWMapper`
- **功能**: 继承 MyBatis-Plus BaseMapper，提供基础 CRUD 操作
- **使用示例**:
```java
@Mapper
public interface UserMapper extends DWMapper<User> {
    // 自定义查询方法
}
```

#### DWService - 通用 Service 接口
- **位置**: `com.dw.common.service.DWService`
- **功能**: 定义标准的 CRUD 操作接口
- **主要方法**:
  - `save(T entity)` - 保存实体
  - `removeById(Serializable id)` - 根据ID删除
  - `updateById(T entity)` - 根据ID更新
  - `getById(Serializable id)` - 根据ID查询
  - `list(Wrapper<T> queryWrapper)` - 条件查询列表

#### DWServiceImpl - 通用 Service 实现类
- **位置**: `com.dw.common.service.impl.DWServiceImpl`
- **功能**: 提供带事务的基础操作实现
- **特性**: 所有 CRUD 操作都配置了 `@Transactional(rollbackFor = Exception.class)`

#### DWController - 通用 Controller 基类
- **位置**: `com.dw.common.controller.DWController`
- **功能**: 提供标准的 REST API 接口
- **主要接口**:
  - `POST /` - 新增
  - `DELETE /{id}` - 删除
  - `PUT /{id}` - 更新
  - `GET /{id}` - 详情查询
  - `GET /list` - 列表查询

### 2. 统一响应体系

#### DWResult - 统一响应包装类
- **位置**: `com.dw.common.result.DWResult`
- **字段**: code、msg、data
- **使用方法**:
  - 成功响应: `DWResult.success(data)` 或 `DWResult.success()`
  - 失败响应: `DWResult.fail(message)` 或 `DWResult.fail(code, message)`

### 3. 异常处理体系

#### GlobalExceptionHandler - 全局异常处理器
- **位置**: `com.dw.common.exception.GlobalExceptionHandler`
- **功能**: 统一处理各种异常类型
- **处理异常类型**:
  - 参数校验异常 (MethodArgumentNotValidException)
  - 约束校验异常 (ConstraintViolationException)
  - 业务异常 (BusinessException)
  - 系统异常 (Exception)

#### BusinessException - 自定义业务异常
- **位置**: `com.dw.common.exception.BusinessException`
- **功能**: 用于业务逻辑中的异常抛出

### 4. ID生成器模块

#### IdUtils - ID生成工具类
- **位置**: `com.dw.common.utils.IdUtils`
- **功能**: 提供多种ID生成策略
- **方法**:
  - `snowflakeId()` - 雪花算法生成长整型ID
  - `uuid()` - 生成32位UUID（无横线）
  - `standardUuid()` - 生成标准36位UUID（含横线）
  - `simpleUuid()` - 生成8位简单UUID

#### SnowflakeIdGenerator - 雪花算法生成器
- **位置**: `com.dw.common.utils.SnowflakeIdGenerator`
- **功能**: 高性能分布式ID生成器
- **特性**: 线程安全，支持高并发，每秒可生成百万级ID

### 5. 操作日志模块

#### @OperationLog - 操作日志注解
- **位置**: `com.dw.common.annotation.OperationLog`
- **属性**:
  - `value` - 操作描述
  - `type` - 操作类型
  - `recordParams` - 是否记录参数
- **使用示例**:
```java
@OperationLog(value = "用户登录", type = OperationType.LOGIN, recordParams = true)
public DWResult<String> login(@RequestBody LoginRequest request) {
    // 业务逻辑
}
```

#### OperationLogAspect - AOP切面实现
- **位置**: `com.dw.common.aspect.OperationLogAspect`
- **功能**: 
  - 自动记录用户操作
  - 获取用户IP地址
  - 统计方法执行时间
  - 记录请求参数和返回结果

#### SysOperationLog - 操作日志实体
- **位置**: `com.dw.common.entity.SysOperationLog`
- **字段**: 操作人、操作描述、请求方法、请求参数、返回结果、IP地址、执行时间等

### 6. 工具类库

#### StringUtils - 字符串处理工具
- **位置**: `com.dw.common.utils.StringUtils`
- **主要方法**:
  - `camelToSnake(String str)` - 驼峰转下划线
  - `snakeToCamel(String str)` - 下划线转驼峰
  - `maskPhone(String phone)` - 手机号脱敏
  - `maskIdCard(String idCard)` - 身份证脱敏
  - `maskEmail(String email)` - 邮箱脱敏
  - `generateRandomString(int length)` - 生成随机字符串

#### DateUtils - 日期时间处理工具
- **位置**: `com.dw.common.utils.DateUtils`
- **基于**: Java 8 Time API
- **主要方法**:
  - `nowDate()` - 获取当前日期字符串
  - `nowDateTime()` - 获取当前日期时间字符串
  - `format(LocalDateTime dateTime, String pattern)` - 格式化日期时间
  - `parse(String dateStr, String pattern)` - 解析日期时间字符串
  - `isWeekend(LocalDate date)` - 判断是否为周末

#### EncryptUtils - 加密工具
- **位置**: `com.dw.common.utils.EncryptUtils`
- **支持算法**:
  - MD5加密
  - SHA256加密
  - Base64编码/解码
- **主要方法**:
  - `md5(String text)` - MD5加密
  - `sha256(String text)` - SHA256加密
  - `base64Encode(String text)` - Base64编码
  - `base64Decode(String encodedText)` - Base64解码

#### JsonUtils - JSON处理工具
- **位置**: `com.dw.common.utils.JsonUtils`
- **功能**: JSON序列化/反序列化
- **主要方法**:
  - `toJson(Object obj)` - 对象转JSON字符串
  - `fromJson(String json, Class<T> clazz)` - JSON字符串转对象
  - `prettyJson(Object obj)` - 格式化输出JSON

### 7. 文件管理模块

#### FileStorage - 文件存储策略接口
- **位置**: `com.dw.common.storage.FileStorage`
- **功能**: 定义文件存储操作规范
- **方法**:
  - `upload()` - 上传文件
  - `delete()` - 删除文件
  - `exists()` - 判断文件是否存在
  - `getUrl()` - 获取文件访问URL

#### LocalFileStorage - 本地文件存储实现
- **位置**: `com.dw.common.storage.LocalFileStorage`
- **功能**: 本地文件系统存储实现
- **特性**: 支持多级目录创建、文件覆盖、路径规范化

#### FileService - 文件服务
- **位置**: `com.dw.common.service.FileService`
- **功能**: 
  - 文件上传/下载服务
  - 支持图片、文档分类管理
  - 文件类型验证
  - 文件大小限制
- **主要方法**:
  - `uploadImage(MultipartFile file)` - 上传图片
  - `uploadDocument(MultipartFile file)` - 上传文档
  - `uploadFile(MultipartFile file)` - 上传通用文件
  - `deleteFile(String fileUrl)` - 删除文件

### 8. Excel处理模块

#### ExcelUtils - Excel工具类
- **位置**: `com.dw.common.utils.ExcelUtils`
- **基于**: EasyExcel 3.3.4
- **主要功能**:
  - 导出Excel文件
  - 多Sheet导出
  - 导入Excel文件
  - 分页读取大文件
- **主要方法**:
  - `exportExcel()` - 导出Excel
  - `exportExcelWithMultipleSheets()` - 多Sheet导出
  - `importExcel()` - 导入Excel
  - `readExcelByPage()` - 分页读取

#### ExcelService - Excel服务
- **位置**: `com.dw.common.service.ExcelService`
- **功能**:
  - Excel导入导出服务
  - 支持大文件处理
  - 数据校验
  - 错误处理
- **主要方法**:
  - `exportExcel()` - 导出Excel到HTTP响应
  - `importExcel()` - 导入Excel文件
  - `importExcelAndProcess()` - 导入Excel并处理数据
  - `generateTemplate()` - 生成Excel模板

#### ExcelImportResult - 导入结果封装
- **位置**: `com.dw.common.excel.ExcelImportResult`
- **功能**: 封装Excel导入结果信息
- **包含信息**: 总记录数、成功数、失败数、错误详情、成功率等

### 9. 异步任务模块

#### AsyncTaskService - 异步任务服务
- **位置**: `com.dw.common.service.AsyncTaskService`
- **功能**: 
  - 异步任务执行
  - 支持邮件发送
  - 支持文件处理
  - 支持数据同步
- **使用示例**:
```java
@Autowired
private AsyncTaskService asyncTaskService;

// 简单异步任务
asyncTaskService.executeAsync(() -> {
    // 异步处理逻辑
});

// 异步发送邮件
asyncTaskService.sendMailAsync(to, subject, content);
```

#### AsyncTaskManager - 异步任务管理器
- **位置**: `com.dw.common.async.AsyncTaskManager`
- **功能**: 
  - 支持链式执行
  - 支持并行执行
  - 支持超时处理
  - 支持回调机制

#### AsyncConfig - 异步配置
- **位置**: `com.dw.common.config.AsyncConfig`
- **功能**: 异步线程池配置，针对不同场景优化

### 10. 配置体系

#### MybatisPlusConfig - MyBatis-Plus配置
- **位置**: `com.dw.common.config.MybatisPlusConfig`
- **配置内容**:
  - 分页插件
  - 逻辑删除
  - 字段自动填充

#### FileStorageConfig - 文件存储配置
- **位置**: `com.dw.common.config.FileStorageConfig`
- **功能**: 文件存储配置，支持多种存储方式切换

#### DWMetaObjectHandler - 自动填充处理器
- **位置**: `com.dw.common.config.DWMetaObjectHandler`
- **功能**: 自动填充创建时间和更新时间

## 测试体系

### 测试覆盖情况
项目包含完整的测试体系，共17个测试类，158个测试用例：

1. **基础测试类**:
   - `DevWheelsApplicationTests` - Spring Boot应用上下文测试
   - `BaseTest` - 测试基类
   - `IntegrationTest` - 集成测试基类

2. **功能模块测试类**:
   - `IdUtilsTest` - ID生成器测试
   - `SnowflakeIdGeneratorTest` - 雪花算法测试
   - `StringUtilsTest` - 字符串工具测试
   - `DateUtilsTest` - 日期工具测试
   - `EncryptUtilsTest` - 加密工具测试
   - `JsonUtilsTest` - JSON工具测试
   - `FileServiceTest` - 文件服务测试
   - `LocalFileStorageTest` - 本地存储测试
   - `ExcelUtilsTest` - Excel工具测试
   - `ExcelServiceTest` - Excel服务测试
   - `AsyncTaskServiceTest` - 异步任务服务测试
   - `AsyncTaskManagerTest` - 异步任务管理器测试
   - `OperationLogAspectTest` - 操作日志测试

3. **测试套件**:
   - `DevWheelsTestSuite` - 完整测试套件，包含所有测试类

### 运行测试
```bash
# 运行所有测试
./mvnw test

# 运行测试套件
./mvnw test -Dtest=DevWheelsTestSuite

# 运行单个测试类
./mvnw test -Dtest=IdUtilsTest
```

## 开发规范

### 新增业务模块步骤
1. 创建实体类继承 `DWEntity`
2. 创建 Mapper 接口继承 `DWMapper<T>`
3. 创建 Service 接口继承 `DWService<T>`
4. 创建 ServiceImpl 继承 `DWServiceImpl<M,T>` 并实现 Service 接口
5. 创建 Controller 继承 `DWController<T>`

### 数据库字段命名
- 使用下划线命名法，如 `user_name`
- 配置已支持自动映射到驼峰命名的 Java 字段，如 `userName`

### 事务管理
- 基础 CRUD 操作已在 `DWServiceImpl` 中配置事务
- 新增业务方法需要事务时，使用 `@Transactional(rollbackFor = Exception.class)`

### 参数校验
- 在 Controller 方法参数上使用 `@Validated`
- 在实体类字段上使用 JSR303 校验注解
- 全局异常处理器会自动处理校验失败的情况

## 项目启动

### 开发环境启动
```bash
./mvnw spring-boot:run
```

### 构建项目
```bash
./mvnw clean package
```

### 访问地址
- 应用程序: http://localhost:8080
- API文档: http://localhost:8080/doc.html

## 项目特色

1. **高度模块化**: 各功能模块独立，易于扩展和维护
2. **完整的基础架构**: 提供统一的开发模式和代码规范
3. **丰富的工具类**: 覆盖常见的开发需求，提高开发效率
4. **完善的异常处理**: 统一的错误响应机制，便于前后端对接
5. **全面的测试覆盖**: 保证代码质量，支持持续集成
6. **详细的文档**: 便于团队协作和项目维护
7. **企业级特性**: 支持操作日志、异步任务、文件管理等企业应用必备功能

## 扩展建议

1. **缓存模块**: 可集成 Redis 实现分布式缓存
2. **消息队列**: 可集成 RabbitMQ 或 Kafka 实现异步消息处理
3. **监控体系**: 可集成 Micrometer 实现应用监控
4. **安全增强**: 可扩展更多的安全认证方式
5. **数据源**: 可支持多数据源配置
6. **分布式**: 可集成 Spring Cloud 实现微服务架构

---

*本文档基于 DevWheels v0.0.1-SNAPSHOT 版本编写，如有更新请及时同步文档内容。*